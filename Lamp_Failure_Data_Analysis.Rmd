---
title: "Lamp time to failure data analysis"
author: "Tetsuya Chau"
date: "2/18/2022"
output: rmarkdown::github_document
---

```{r}
#install.packages("R2jags")
library(R2jags)
```


```{r}
#Read in data
dataM <- read.table(url("https://alysongwilson.github.io/BR/table42.txt"),header=T)$Hours

show(dataM)
```

Question #1.

I chose the prior to be alpha ~ dunif(1,1.5) because that was the prior that was given to us and lambda ~ dexp(299.57) because that's the rate parameter that was contained in the interval (0,0.01) with a 95% certainty. I solved this by setting the CDF of the exponential distribution equal to .95, plugging in .01 into x, and solving for lambda.


Question #2.

```{r}
md2 <- 
"model {
  for(i in 1:31){
    dataM[i] ~ dgamma(alpha,lambda); 
  }
  lambda ~ dexp(299.57)
  alpha ~ dunif(1,1.5)
}
"

viscos2.sim <- jags(
  data=c('dataM'),
  parameters.to.save=c('lambda','alpha'),
  model.file=textConnection(md2),
  n.iter=27000,
  n.burnin=2000,
  n.chains=4,
  n.thin=1
)

plot(viscos2.sim$BUGSoutput$sims.matrix[,2],type="l")

length(viscos2.sim$BUGSoutput$sims.matrix[,2])
effectiveSize(viscos2.sim$BUGSoutput$sims.matrix[,2])

gelman.diag(viscos2.sim$BUGSoutput)

#head(viscos.sim$BUGSoutput$sims.matrix)

viscos2.sim$BUGSoutput$DIC

head(viscos2.sim$BUGSoutput$sims.matrix)

sims2 <- as.mcmc(viscos2.sim)
chains2 <- as.matrix(sims2)

#plot(chains2[,2],type="l")

hist(viscos2.sim$BUGSoutput$sims.matrix[,'lambda'])
lambdas <- viscos2.sim$BUGSoutput$sims.matrix[,'lambda']
acf(viscos2.sim$BUGSoutput$sims.matrix[,'lambda'])

alpha <- viscos2.sim$BUGSoutput$sims.matrix[,1]
hist(alpha)

lambda <- viscos2.sim$BUGSoutput$sims.matrix[,3]
hist(lambda)
```

Question #3

```{r}
# finding quantities
#Mean
mean(chains2[,2])   # true value is 290/477.07 = 0.6078773 

#Median
median(chains2[,2])   # true value is qgamma(0.5,290,477.07) = 0.6071787

#95% Credible Interval 
quantile(chains2[,2],c(0.025,0.975))   # true value is qgamma(c(0.025,0.975),290,477.07) = (0.5399208,0.6798034)

#Posterior Predictive

#PPD_samp1 <- rgamma(length(alpha))
PPD_samp <- rgamma(length(chains2[,2]),alpha,chains2[,2])

#rgamma(100000,length(alpha),5,)

#rgamma()
PPD <- function(x) { 
  out <- rep(NA,length(x))
  for (i in 1:length(x)) {
    out[i] <- exp(290*log(477.07)+4*log(x[i])-lgamma(290)-lgamma(5)
                  +lgamma(295)-295*log(x[i]+477.07))
  }
  return(out)
}

#hist(PPD_samp,br=50,xlim=c(0,30))
#par(new=T)
curve(PPD(x),xlim=c(0,30),col=2)


quantile(PPD_samp,0.01)
quantile(PPD_samp,0.99)

quantile(PPD_samp,c(0.01,0.99))


```



The 98% prediction interval of the next observation is between 5.3327e-05 and 1.137378e-02. 


Question #4.

```{r}
#hist(dataM,br=50,xlim=c(0,30),main="histogram of PPD",
        #xlab="",
        #ylab="",)
#par(new=T)
curve(PPD(x),xlim=c(0,30),col=2)
```



I plotted the histogram of the posterior predictive distribution and compared it to the histogram of the data and observed that the two histograms look similar with a mean of around 5 - 10. Thus, I concluded that the model fits the data well. 

```{r}
mean(PPD_samp)
```


Question #5.

```{r}

#n <- 31
#sum <- 17907

#mean_of_MTTF <- sum/(n-1)

#print(mean_of_MTTF)

#mean(PPD_samp)

#1/qgamma(c(.05,.95),(0.015)+n,(3)+sum)
#show(dataM)

EX <- alpha/lambda
mean(EX)

quantile(EX,c(0.05,0.95))
```


The point estimate is 586.9625 and the 90% probability interval for MTTF is (449.3526,760.2078).



Question #6.
```{r}
#median(PPD_samp)

#1/qgamma(c(.025,.975),(0.015)+n,(3)+sum)

medi <- qgamma(.5,alpha,lambda)


quantile(medi,c(0.025,0.975))

median(medi)

```



My point estimate for the median LCD failure time is 431.2719. The 95% probability interval is (315.1142,601.0926). The difference between the probability interval of the MTTF and the median is that the interval is wider for the probability interval for the median and that's because we found the 95% probability interval which generally outputs a wider interval than a 90% probability interval. The mean is also affected more by the outliers so that could explain why the mean time to failure has a greater point estimate than the point estimate based on the median.



Question #7.

```{r}
#meanhrs <- mean(dataM)
#meanhrs
#meanhrs/20
```


  Based on Bayesian analysis, I found the mean of the lamp failure time to be approximately 587 hours. I also observed that there is a 90% probability that the mean time to failure for the lamps lies between 449.3526 and 760.2078 hours given the data and prior knowledge. This means that the average time to failure for the lamps is in the interval of (449.3526,760.20178) with a 90% chance. 
  
  I also observed that the median of the lamp failure time is approximately 431.2719 hours with a 95% probability interval for the median LCD lamp failure time of (315.1142,601.0926). In other words, there is a 95% probability that the mean time to failure for the LCD lamps is in between 315.1142 and 760.20178 hours given the data and prior knowledge. 
  
  Based on these calculations, I can conclude that with the lamp usage of 20 hours per week, we can expect the lamps to last about 29 weeks or about 6 and a half months before we have to replace them. In other words, we can suggest that the 5 lamps that are operating independently should be replaced every half a year based on the average lamp failure time based on the mean time to failure. If we use the median as the point estimate, we can expect the lamps to last around 22 weeks or 5 months so the lamps should be replaced every 5 months based on the median of lamp failure time. 






